/**
 * hdhub4u - Built from src/hdhub4u/
 * Generated: 2026-02-14T11:08:50.884Z
 */
var S=Object.defineProperty,me=Object.defineProperties,Ee=Object.getOwnPropertyDescriptor,xe=Object.getOwnPropertyDescriptors,Ce=Object.getOwnPropertyNames,j=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var G=(e,t,n)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,T=(e,t)=>{for(var n in t||(t={}))Q.call(t,n)&&G(e,n,t[n]);if(j)for(var n of j(t))Re.call(t,n)&&G(e,n,t[n]);return e},X=(e,t)=>me(e,xe(t));var we=(e,t)=>{for(var n in t)S(e,n,{get:t[n],enumerable:!0})},Ae=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Ce(t))!Q.call(e,r)&&r!==n&&S(e,r,{get:()=>t[r],enumerable:!(o=Ee(t,r))||o.enumerable});return e};var ye=e=>Ae(S({},"__esModule",{value:!0}),e);var p=(e,t,n)=>new Promise((o,r)=>{var s=a=>{try{u(n.next(a))}catch(h){r(h)}},i=a=>{try{u(n.throw(a))}catch(h){r(h)}},u=a=>a.done?o(a.value):Promise.resolve(a.value).then(s,i);u((n=n.apply(e,t)).next())});var Me={};we(Me,{clearAllCache:()=>de,getCacheStats:()=>O,getStreams:()=>Le});module.exports=ye(Me);var C="https://hdhub4u.frl",K="https://search.pingora.fyi/collections/post/documents/search",J="https://raw.githubusercontent.com/phisher98/TVVVV/refs/heads/main/domains.json",R={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8","Accept-Language":"en-US,en;q=0.9"};function Z(e){C=e,R.Referer=C+"/",R.Origin=C}function Y(e){if(!e||e===0)return"Unknown";let t=1024,n=["Bytes","KB","MB","GB","TB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(1))+" "+n[o]}function ee(e){return e.replace(/[a-zA-Z]/g,t=>String.fromCharCode((t<="Z"?90:122)>=(t=t.charCodeAt(0)+13)?t:t-26))}function U(e){try{if(typeof atob!="undefined")return atob(e)}catch(t){console.log("[atob] Error:",t.message)}return e}function te(e){try{if(typeof btoa!="undefined")return btoa(e)}catch(t){console.log("[btoa] Error:",t.message)}return e}function oe(e,t){let n=l=>l.toLowerCase().replace(/[^a-z0-9\s]/g,""),o=n(e),r=n(t);if(r.includes(o))return!0;let s=o.split(/\s+/).filter(l=>l.length>0),i=r.split(/\s+/).filter(l=>l.length>0);if(s.length===0)return!1;let u=["the","a","an","of","and","or"],a=s.find(l=>!u.includes(l))||s[0];return i.slice(0,3).some(l=>l.includes(a)||a.includes(l))?s.every(l=>i.some(f=>f.includes(l)||l.includes(f))):!1}function ne(e){let t=e.match(/([\d.]+)\s*(GB|MB|KB|TB)/i);if(!t)return 0;let n=parseFloat(t[1]),o=t[2].toUpperCase(),r={KB:1024,MB:1024**2,GB:1024**3,TB:1024**4};return n*(r[o]||0)}function L(e){return e.replace(/<[^>]*>/g,"").trim()}function re(e){let t=[],n=new RegExp(`<a[^>]*href=["']([^"']*)["'][^>]*>(.*?)<\\/a>`,"gis"),o;for(;(o=n.exec(e))!==null;)t.push({href:o[1],text:L(o[2])});return t}var M=0,b=!1,De=36e5;function v(){Date.now()-M<De||b||(b=!0,He().then(()=>{b=!1}).catch(t=>{console.log("[Domain Update] Background error:",t.message),b=!1}))}function He(){return p(this,null,function*(){try{console.log("[Domain Update] Checking for new domain (background)...");let t=yield(yield fetch(J)).json();t&&t.HDHUB4u&&C!==t.HDHUB4u?(console.log("[Domain Update] \u2713 Domain updated:",t.HDHUB4u),Z(t.HDHUB4u),M=Date.now()):(console.log("[Domain Update] \u2713 Domain unchanged"),M=Date.now(),R.Referer=C+"/",R.Origin=C)}catch(e){console.log("[Domain Update] Error:",e.message),R.Referer=C+"/",R.Origin=C}})}function ke(){R.Referer=C+"/",R.Origin=C}ke();function I(o){return p(this,arguments,function*(e,t={},n=2){let r=T(T({},R),t);for(let s=0;s<=n;s++)try{let i=yield fetch(e,{headers:r});if(!i.ok&&s<n){console.log(`[HTTP] Retry ${s+1}/${n} for:`,e),yield se(1e3*(s+1));continue}return i}catch(i){if(s===n)throw i;console.log(`[HTTP] Error on attempt ${s+1}, retrying:`,i.message),yield se(1e3*(s+1))}throw new Error("Max retries reached")})}function se(e){return new Promise(t=>setTimeout(t,e))}function _(n){return p(this,arguments,function*(e,t={}){try{let o=T(T({},R),t),r=yield fetch(e,{method:"HEAD",headers:o,redirect:"manual"}),s=r.headers.get("hx-redirect")||r.headers.get("location")||r.headers.get("Location");return s?s.startsWith("http")?s:new URL(e).origin+s:null}catch(o){return console.log("[HTTP] Redirect fetch error:",o.message),null}})}function ae(n){return p(this,arguments,function*(e,t={}){try{return yield(yield I(e,t)).json()}catch(o){return console.log("[HTTP] JSON fetch error:",o.message),null}})}function k(n){return p(this,arguments,function*(e,t={}){try{return yield(yield I(e,t)).text()}catch(o){return console.log("[HTTP] Text fetch error:",o.message),""}})}var Te="https://proxy.leokimpese.workers.dev";function Ie(e){return`${Te}?url=${encodeURIComponent(e)}`}function ie(e){return p(this,null,function*(){console.log("[REDIRECT] Processing:",e);try{if(e.includes("pixel.hubcdn.fans")||e.includes("?id=")){console.log("[REDIRECT] Detected HTTP redirect link, following redirect...");let d=yield _(e);if(d&&d!==e)return console.log("[REDIRECT] Followed HTTP redirect to:",d),d;let g=yield k(e),l=g.match(/<meta[^>]*http-equiv=["']refresh["'][^>]*content=["'][^"']*url=([^"']+)["']/i);if(l&&l[1])return console.log("[REDIRECT] Found meta refresh redirect:",l[1]),l[1];let f=g.match(/window\.location(?:\.href)?\s*=\s*["']([^"']+)["']/i);return f&&f[1]?(console.log("[REDIRECT] Found JavaScript redirect:",f[1]),f[1]):(console.log("[REDIRECT] Could not extract redirect, returning original URL"),e)}let t=yield k(e),n=/s\('o','([A-Za-z0-9+/=]+)'|ck\('_wp_http_\d+','([^']+)'/g,o="",r;for(;(r=n.exec(t))!==null;){let d=r[1]||r[2];d&&(o+=d)}if(!o)return console.log("[REDIRECT] No encoded data found"),e;let s=U(ee(U(U(o)))),i=JSON.parse(s),u=U(i.o||"").trim();if(u)return console.log("[REDIRECT] Decoded URL:",u),u;let a=te(i.data||"").trim(),h=(i.blog_url||"").trim();if(h&&a){console.log("[REDIRECT] Fetching from wpHttp");let d=yield k(`${h}?re=${a}`),g=L(d);return console.log("[REDIRECT] Final URL:",g),g}return e}catch(t){return console.log("[REDIRECT] Error:",t.message),e}})}function N(e){return p(this,null,function*(){console.log("[PIXELDRAIN] Extracting from:",e);let t=e.match(/(?:file|u)\/([A-Za-z0-9]+)/),n=t?t[1]:e.split("/").pop();if(!n)return console.log("[PIXELDRAIN] No file ID found"),[];try{console.log("[PIXELDRAIN] File ID:",n);let o=yield ae(`https://pixeldrain.com/api/file/${n}/info`);if(!o)return console.log("[PIXELDRAIN] Failed to fetch file info"),[];let r=o.name?o.name.match(/(\d{3,4})p/):null,s=r?r[0]:"Unknown",i=`https://pixeldrain.com/api/file/${n}?download`,u=Ie(i);return console.log("[PIXELDRAIN] Direct URL:",i),console.log("[PIXELDRAIN] Proxied URL:",u),[{source:"Pixeldrain",quality:s,url:u,size:o.size||0,filename:o.name}]}catch(o){return console.log("[PIXELDRAIN] Error:",o.message),[]}})}function ce(e,t){return p(this,null,function*(){console.log("[HUBDRIVE] Extracting from:",e);try{let o=(yield k(e,{Referer:t})).match(new RegExp(`<a[^>]*href=["']([^"']*hubcloud[^"']*)["'][^>]*>.*?\\[HubCloud Server\\]`,"is"));if(o&&o[1]){let r=o[1];return console.log("[HUBDRIVE] Found HubCloud link:",r),yield B(r,e)}return console.log("[HUBDRIVE] No HubCloud link found"),[]}catch(n){return console.log("[HUBDRIVE] Error:",n.message),[]}})}function B(e,t){return p(this,null,function*(){console.log("[HUBCLOUD] Extracting from:",e);let n=e;n.includes("hubcloud.ink")&&(n=n.replace("hubcloud.ink","hubcloud.dad"));try{let o=yield k(n,{Referer:t});if(!n.includes("hubcloud.php")){let f=o.match(/var url = '([^']*)'/);f&&f[1]&&(n=f[1],console.log("[HUBCLOUD] Following script URL:",n),o=yield k(n,{Referer:e}))}let r=o.match(/<i[^>]*id=["']size["'][^>]*>([^<]*)<\/i>/i),s=r?r[1].trim():"",i=ne(s),u=o.match(/<div[^>]*class=["'][^"']*card-header[^"']*["'][^>]*>([^<]*)<\/div>/i),h=(u?u[1].trim():"").match(/(\d{3,4})p/),d=h?h[0]:"Unknown";console.log("[HUBCLOUD] Size:",s,"Quality:",d);let g=re(o),l=[];for(let f of g){let m=f.text,w=f.href;if(m.includes("ZipDisk")||m.includes("Telegram")){console.log("[HUBCLOUD] Skipping:",m);continue}let A=`HubCloud [${m}]`;if(m.includes("Download File")||m.includes("FSL")||m.includes("S3")||m.includes("10Gbps"))console.log("[HUBCLOUD] Direct server:",m),l.push({source:A,quality:d,url:w,size:i});else if(m.includes("BuzzServer")){console.log("[HUBCLOUD] Processing BuzzServer");let E=yield _(`${w}/download`,{Referer:w});E&&(console.log("[HUBCLOUD] BuzzServer URL:",E),l.push({source:A,quality:d,url:E,size:i}))}else if(w.includes("pixeldra")){console.log("[HUBCLOUD] Found Pixeldrain link");let E=yield N(w);E[0]&&l.push(E[0])}}return console.log(`[HUBCLOUD] Extracted ${l.length} streams`),l}catch(o){return console.log("[HUBCLOUD] Error:",o.message),[]}})}var $="https://cache.leokimpese.workers.dev";function le(e,t,n,o){return`${e}_${t}_${n||"null"}_${o||"null"}`}function ue(e,t,n,o){return p(this,null,function*(){let r=le(e,t,n,o);try{console.log("[API-CACHE] Fetching:",r);let s=yield fetch(`${$}/${r}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.status===404)return console.log("[API-CACHE] Miss:",r),null;if(!s.ok)return console.log("[API-CACHE] Error:",s.status),null;let i=yield s.json();return!i||!i.streams||!Array.isArray(i.streams)?(console.log("[API-CACHE] Invalid response format"),null):(console.log(`[API-CACHE] Hit: ${r} (${i.streams.length} streams)`),i.streams)}catch(s){return console.log("[API-CACHE] Fetch error:",s.message),null}})}function he(e,t,n,o,r,s=3600){return p(this,null,function*(){let i=le(e,t,n,o);try{console.log(`[API-CACHE] Saving: ${i} (${r.length} streams, TTL: ${s}s)`);let u=yield fetch($,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:i,streams:r,ttl:s,metadata:{tmdbId:e,mediaType:t,season:n,episode:o,timestamp:Date.now()}})});return u.ok?(console.log("[API-CACHE] Saved successfully"),!0):(console.log("[API-CACHE] Save failed:",u.status),!1)}catch(u){return console.log("[API-CACHE] Save error:",u.message),!1}})}function de(){return p(this,null,function*(){try{console.log("[API-CACHE] Clearing all cache...");let e=yield fetch(`${$}/clearall`,{method:"POST"});return e.ok?(console.log("[API-CACHE] All cache cleared"),!0):(console.log("[API-CACHE] Clear failed:",e.status),!1)}catch(e){return console.log("[API-CACHE] Clear error:",e.message),!1}})}function O(){return p(this,null,function*(){try{let e=yield fetch(`${$}/stats`,{method:"GET"});return e.ok?yield e.json():{totalEntries:0,totalSize:0,error:"Failed to fetch stats"}}catch(e){return console.log("[API-CACHE] Stats error:",e.message),{totalEntries:0,totalSize:0,error:e.message}}})}var fe=!1;function Ue(e){return p(this,null,function*(){let t=e.replace(/Season \d+/i,"").trim(),n=new URLSearchParams({q:t,query_by:"post_title",sort_by:"sort_by_date:desc"});try{let r=yield(yield I(`${K}?${n.toString()}`)).json(),s=[];if(r.hits&&r.hits.length>0)return r.hits.forEach(l=>{s.push({title:l.document.post_title,url:C+l.document.permalink,source:"Pingora",searchedTitle:e})}),s;console.log(`[Search] "${e}" - Pingora returned 0 results, trying Native Search`);let i=`${C}/?s=${encodeURIComponent(t)}`,a=yield(yield I(i)).text(),h=[],d=new RegExp("<article[^>]*>.*?<\\/article>","gis");return(a.match(d)||[]).forEach(l=>{let f=l.match(/<a[^>]*href=["']([^"']*)["'][^>]*>(.*?)<\/a>/i);if(f){let m=f[1],w=f[2].replace(/<[^>]*>/g,"").trim();m&&w&&h.push({title:w,url:m,source:"Native",searchedTitle:e})}}),h}catch(o){return console.log(`[Search] "${e}" - Error:`,o.message),[]}})}function Pe(e){return p(this,null,function*(){console.log(`[Parallel Search] Searching ${e.length} titles simultaneously...`);let t=Date.now(),n=e.map(s=>Ue(s)),o=yield Promise.all(n),r=Date.now()-t;console.log(`[Parallel Search] Completed in ${r}ms`);for(let s=0;s<o.length;s++)if(o[s].length>0)return console.log(`[Parallel Search] Found ${o[s].length} results for: "${e[s]}"`),{results:o[s],usedTitle:e[s]};return console.log("[Parallel Search] No results found in any search"),{results:[],usedTitle:""}})}function z(n){return p(this,arguments,function*(e,t=C){if(!e)return console.log("[EXTRACTOR] Empty URL"),[];console.log("[EXTRACTOR] Processing:",e);try{let o=new URL(e).hostname;if(e.includes("?id=")||o.includes("techyboy")||o.includes("gdtot")){let r=yield ie(e);return r&&r!==e?yield z(r,e):[]}if(o.includes("hubcloud")||o.includes("hubcdn"))return yield B(e,t);if(o.includes("hubdrive"))return yield ce(e,t);if(o.includes("pixeldrain"))return yield N(e);if(o.includes("hblinks")){let s=yield(yield I(e,{Referer:t})).text(),i=/<a[^>]*href=["']([^"']*)["'][^>]*>/gi,u=[],a;for(;(a=i.exec(s))!==null;){let g=a[1];if(g&&g.startsWith("http")){if(g.includes("hblinks.dad")&&!g.includes("/archives/"))continue;u.push(g)}}console.log(`[HBLINKS] Found ${u.length} valid links - processing in parallel`);let h=u.map(g=>z(g,e));return(yield Promise.all(h)).flat()}return console.log("[EXTRACTOR] No matching extractor"),[]}catch(o){return console.log("[EXTRACTOR] Error:",o.message),[]}})}function Se(e,t){return p(this,null,function*(){console.log(`[Parallel Extraction] Processing ${e.length} links simultaneously...`);let n=Date.now(),o=e.map(u=>z(u,t).catch(a=>(console.log(`[Parallel Extraction] Error on ${u}:`,a.message),[]))),r=yield Promise.all(o),s=Date.now()-n,i=r.flat().length;return console.log(`[Parallel Extraction] Completed in ${s}ms - Found ${i} streams`),r.flat()})}function be(e,t,n,o){let r=[],s=a=>a.includes("hdhub4u.")||/\/20\d{2}\//.test(a)||a.includes("-hindi-")||a.includes("-movie/")||a.includes("-series/")||a.includes("-episodes/")||a.includes("facebook.com")||a.includes("telegram.me")||a.includes("how-to-download")||a.toLowerCase().endsWith(".zip")||a.toLowerCase().includes(".zip?");if(t==="movie"){let a=new RegExp(`<a[^>]*href=["']([^"']*)["'][^>]*>(.*?)<\\/a>`,"gis"),h;for(;(h=a.exec(e))!==null;){let d=h[1],g=h[2].replace(/<[^>]*>/g,"");if(s(d))continue;let l=e.substring(Math.max(0,h.index-200),Math.min(e.length,h.index+400));(g+l).match(/1080p|2160p|4k/i)&&d&&d.startsWith("http")&&r.push({url:d,requiresQualityCheck:!1,preFilteredQuality:!0})}}else if(t==="tv"&&n&&o){let a=parseInt(o),h=a+1,d=new RegExp(`<(?:h[1-6]|strong|span|a)[^>]*>\\s*(?:Episode|Ep|E|EPiSODE)\\s*0?${a}\\b`,"i"),g=new RegExp(`<(?:h[1-6]|strong|span|a)[^>]*>\\s*(?:Episode|Ep|E|EPiSODE)\\s*0?${h}\\b`,"i"),l=e.match(d);if(l){let f=l.index,m=e.substring(f+10).match(g),w=m?f+10+m.index:f+6e3,A=e.substring(f,w);if(console.log(`[TV] Analyzing slice for Episode ${a} (${A.length} chars)`),/1080p|2160p|4k|uhd|720p|480p/i.test(A)){console.log("[TV] Quality labels found in episode block. Filtering at HTML stage.");let E=/(720p|480p|360p|1080p|2160p|4k|uhd)/gi,H=[],c;for(E.lastIndex=0;(c=E.exec(A))!==null;)H.push({quality:c[1].toLowerCase(),index:c.index,isHighQuality:/1080p|2160p|4k|uhd/i.test(c[1])});console.log(`[TV] Found ${H.length} quality markers`);for(let x=0;x<H.length;x++){let y=H[x];if(!y.isHighQuality){console.log(`[TV] Marker ${x+1}: ${y.quality} - SKIPPING (low quality)`);continue}console.log(`[TV] Marker ${x+1}: ${y.quality} - PROCESSING (high quality)`);let D=y.index,F=H[x+1],ge=F?F.index:A.length,W=A.substring(D,ge);console.log(`[TV]   Search zone: ${W.length} chars`);let pe=/<a[^>]*href=["']([^"']+)["'][^>]*>/gi,q,V=0;for(;(q=pe.exec(W))!==null;){let P=q[1];P.startsWith("http")&&!s(P)&&(console.log(`[TV]   \u2192 Found link: ${P.substring(0,60)}...`),V++,r.push({url:P,requiresQualityCheck:!1,preFilteredQuality:!0}))}V===0&&console.log("[TV]   \u2192 No links found in this zone")}}else{console.log("[TV] No quality labels in episode block. Will check quality during extraction.");let E=/href=["']([^"']+)["']/gi,H;for(;(H=E.exec(A))!==null;){let c=H[1];c.startsWith("http")&&!s(c)&&r.push({url:c,requiresQualityCheck:!0,preFilteredQuality:!1})}}}}let i=new Set,u=[];for(let a of r)i.has(a.url)||(i.add(a.url),u.push(a));return u}function $e(e,t,n,o){return be(e,t,n,o).map(s=>s.url)}function Le(e,t,n,o){return p(this,null,function*(){if(console.log("[HDHub4u] Starting:",e,t,n,o),fe)console.log("[CACHE] \u26A0\uFE0F  DISABLED FOR TESTING - Fresh fetch every time");else try{let r=yield ue(e,t,n,o);if(r)return console.log(`[HDHub4u] \u26A1 Returning ${r.length} cached streams from API`),v(),r}catch(r){console.log("[HDHub4u] Cache fetch error, continuing with fresh fetch:",r.message)}try{v();let r=`https://api.themoviedb.org/3/${t}/${e}?api_key=342c3872f1357c6e1da3a5ac1ccc3605&append_to_response=external_ids`,s=yield fetch(r).then(c=>c.json()),i=s.imdb_id||s.external_ids&&s.external_ids.imdb_id,u=t==="tv"?s.name:s.title,a="";t==="movie"&&s.release_date?a=s.release_date.split("-")[0]:t==="tv"&&s.first_air_date&&(a=s.first_air_date.split("-")[0]);let h=[];if(i){console.log("[HDHub4u] IMDb ID found:",i);let[c,x]=yield Promise.all([fetch(`https://api.imdbapi.dev/titles/${i}`).then(y=>y.json()).catch(()=>null),fetch(`https://api.imdbapi.dev/titles/${i}/akas`).then(y=>y.json()).catch(()=>({akas:[]}))]);c&&(c.originalTitle&&h.push(c.originalTitle),c.primaryTitle&&!h.includes(c.primaryTitle)&&h.push(c.primaryTitle),u=c.originalTitle||c.primaryTitle),x&&x.akas&&x.akas.filter(D=>D.country&&D.country.code==="IN").map(D=>D.text).filter(D=>/^[a-zA-Z0-9\s\-':.!&]+$/.test(D)).forEach(D=>{h.includes(D)||h.push(D)})}h.length===0&&h.push(u);let{results:d,usedTitle:g}=yield Pe(h);if(d.length===0)return console.log("[HDHub4u] No search results - NOT caching empty result"),[];let l=d.find(c=>oe(g,c.title)?!(t==="tv"&&n&&!c.title.toLowerCase().includes(`season ${n}`)):!1);if(!l)return console.log("[HDHub4u] No valid match found - NOT caching empty result"),[];console.log("[HDHub4u] Found Page:",l.title);let f=yield k(l.url),m=$e(f,t,n,o);console.log(`[HDHub4u] Found ${m.length} candidate links`);let w=yield Se(m,l.url),A=[];w.forEach(c=>{!c||!c.url||c.quality==="Unknown"||c.quality.includes("480p")||c.quality.includes("720p")||A.push({name:c.quality,title:`${u}${a?` (${a})`:""} ${t==="tv"?`S${n}E${o}`:""}`,url:c.url,size:Y(c.size),headers:R})});let E=A.sort((c,x)=>{let y={"2160p":10,"4k":10,"1080p":8};return(y[x.name]||0)-(y[c.name]||0)}),H=E.map((c,x)=>X(T({},c),{name:`${x+1}. ${c.name}`}));return E.length===0?(console.log("[HDHub4u] No valid streams extracted - NOT caching empty result"),[]):(fe?console.log("[CACHE] \u26A0\uFE0F  Not saving to cache (testing mode)"):he(e,t,n,o,E,3600).then(()=>(console.log(`[API-CACHE] \u2705 Cached ${E.length} streams in background`),O())).then(c=>{console.log(`[API-CACHE] Stats: ${c.totalEntries||0} entries, ${c.totalSize||0} total streams`)}).catch(c=>{console.log("[API-CACHE] Background save error (non-critical):",c.message)}),console.log(`[HDHub4u] \u2705 Returning ${E.length} streams to user`),E)}catch(r){return console.error("[HDHub4u] Critical Error:",r),[]}})}
