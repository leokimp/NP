/**
 * hdhub4u - Built from src/hdhub4u/
 * Generated: 2026-02-14T18:31:00.965Z
 */
var O=Object.defineProperty,ye=Object.defineProperties,Ce=Object.getOwnPropertyDescriptor,ke=Object.getOwnPropertyDescriptors,Ue=Object.getOwnPropertyNames,X=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var Z=(e,t,o)=>t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,L=(e,t)=>{for(var o in t||(t={}))Y.call(t,o)&&Z(e,o,t[o]);if(X)for(var o of X(t))Se.call(t,o)&&Z(e,o,t[o]);return e},ee=(e,t)=>ye(e,ke(t));var Ae=(e,t)=>{for(var o in t)O(e,o,{get:t[o],enumerable:!0})},He=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Ue(t))!Y.call(e,s)&&s!==o&&O(e,s,{get:()=>t[s],enumerable:!(n=Ce(t,s))||n.enumerable});return e};var be=e=>He(O({},"__esModule",{value:!0}),e);var m=(e,t,o)=>new Promise((n,s)=>{var r=i=>{try{l(o.next(i))}catch(d){s(d)}},c=i=>{try{l(o.throw(i))}catch(d){s(d)}},l=i=>i.done?n(i.value):Promise.resolve(i.value).then(r,c);l((o=o.apply(e,t)).next())});var Be={};Ae(Be,{clearAllCache:()=>xe,getCacheStats:()=>G,getStreams:()=>Me});module.exports=be(Be);var U="https://hdhub4u.frl",te="https://search.pingora.fyi/collections/post/documents/search",oe="https://raw.githubusercontent.com/phisher98/TVVVV/refs/heads/main/domains.json",S={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8","Accept-Language":"en-US,en;q=0.9"};function ne(e){U=e,S.Referer=U+"/",S.Origin=U}function re(e){if(!e||e===0)return"Unknown";let t=1024,o=["Bytes","KB","MB","GB","TB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(1))+" "+o[n]}function B(e){return e.replace(/[a-zA-Z]/g,t=>String.fromCharCode((t<="Z"?90:122)>=(t=t.charCodeAt(0)+13)?t:t-26))}function b(e){try{if(typeof atob!="undefined")return atob(e)}catch(t){console.log("[atob] Error:",t.message)}return e}function se(e){try{if(typeof btoa!="undefined")return btoa(e)}catch(t){console.log("[btoa] Error:",t.message)}return e}function ie(e,t){let o=u=>u.toLowerCase().replace(/[^a-z0-9\s]/g,""),n=o(e),s=o(t);if(s.includes(n))return!0;let r=n.split(/\s+/).filter(u=>u.length>0),c=s.split(/\s+/).filter(u=>u.length>0);if(r.length===0)return!1;let l=["the","a","an","of","and","or"],i=r.find(u=>!l.includes(u))||r[0];return c.slice(0,3).some(u=>u.includes(i)||i.includes(u))?r.every(u=>c.some(x=>x.includes(u)||u.includes(x))):!1}function N(e){let t=e.match(/([\d.]+)\s*(GB|MB|KB|TB)/i);if(!t)return 0;let o=parseFloat(t[1]),n=t[2].toUpperCase(),s={KB:1024,MB:1024**2,GB:1024**3,TB:1024**4};return o*(s[n]||0)}function z(e){return e.replace(/<[^>]*>/g,"").trim()}function _(e){let t=[],o=new RegExp(`<a[^>]*href=["']([^"']*)["'][^>]*>(.*?)<\\/a>`,"gis"),n;for(;(n=o.exec(e))!==null;)t.push({href:n[1],text:z(n[2])});return t}var F=0,v=!1,De=36e5;function V(){Date.now()-F<De||v||(v=!0,Le().then(()=>{v=!1}).catch(t=>{console.log("[Domain Update] Background error:",t.message),v=!1}))}function Le(){return m(this,null,function*(){try{console.log("[Domain Update] Checking for new domain (background)...");let t=yield(yield fetch(oe)).json();t&&t.HDHUB4u&&U!==t.HDHUB4u?(console.log("[Domain Update] \u2713 Domain updated:",t.HDHUB4u),ne(t.HDHUB4u),F=Date.now()):(console.log("[Domain Update] \u2713 Domain unchanged"),F=Date.now(),S.Referer=U+"/",S.Origin=U)}catch(e){console.log("[Domain Update] Error:",e.message),S.Referer=U+"/",S.Origin=U}})}function Te(){S.Referer=U+"/",S.Origin=U}Te();function I(n){return m(this,arguments,function*(e,t={},o=2){let s=L(L({},S),t);for(let r=0;r<=o;r++)try{let c=yield fetch(e,{headers:s});if(!c.ok&&r<o){console.log(`[HTTP] Retry ${r+1}/${o} for:`,e),yield ce(1e3*(r+1));continue}return c}catch(c){if(r===o)throw c;console.log(`[HTTP] Error on attempt ${r+1}, retrying:`,c.message),yield ce(1e3*(r+1))}throw new Error("Max retries reached")})}function ce(e){return new Promise(t=>setTimeout(t,e))}function ae(o){return m(this,arguments,function*(e,t={}){try{let n=L(L({},S),t),s=yield fetch(e,{method:"HEAD",headers:n,redirect:"manual"}),r=s.headers.get("hx-redirect")||s.headers.get("location")||s.headers.get("Location");return r?r.startsWith("http")?r:new URL(e).origin+r:null}catch(n){return console.log("[HTTP] Redirect fetch error:",n.message),null}})}function le(o){return m(this,arguments,function*(e,t={}){try{return yield(yield I(e,t)).json()}catch(n){return console.log("[HTTP] JSON fetch error:",n.message),null}})}function H(o){return m(this,arguments,function*(e,t={}){try{return yield(yield I(e,t)).text()}catch(n){return console.log("[HTTP] Text fetch error:",n.message),""}})}function ue(e){return[/pixeldrain\.com\/api\/file\/.*\?download/,/video-downloads\.googleusercontent\.com/,/drive\.google\.com\/uc\?/,/docs\.google\.com.*export/].some(o=>o.test(e))}function D(e){return[/dl\.php\?link=/,/pixel\.hubcdn/,/pixel\.rohitkiskk/,/\/go\//,/redirect/i].some(o=>o.test(e))}function P(e,t=10){return m(this,null,function*(){console.log("[RESOLVE] Starting redirect resolution for:",e.substring(0,80)+"...");let o=e,n=0,s=["bonuscaf.com","urbanheadline.com","propellerads","adsterra","popads","popcash","blogspot.com"];for(;n<t;){if(console.log(`[RESOLVE] Hop ${n+1}:`,o.substring(0,80)+"..."),ue(o))return console.log("[RESOLVE] Found direct link!"),o;try{let r=yield fetch(o,{method:"GET",headers:S,redirect:"manual"}),c=r.headers.get("location");if(c){o=c.startsWith("http")?c:new URL(c,o).toString(),n++;continue}let l=r.headers.get("content-type")||"";if(l.includes("video/")||l.includes("application/octet-stream")||l.includes("application/x-matroska"))return console.log("[RESOLVE] Found direct file download"),o;if(l.includes("text/html")){let i=yield r.text(),d=/s\('o','([A-Za-z0-9+/=]+)'|ck\('_wp_http_\d+','([^']+)'/g,f="",h;for(;(h=d.exec(i))!==null;){let g=h[1]||h[2];g&&(f+=g)}if(f){console.log("[RESOLVE] Found encoded data, decoding...");try{let g=b(B(b(b(f)))),p=JSON.parse(g),a=b(p.o||"").trim();if(a){console.log("[RESOLVE] Decoded URL from encoded data"),o=a,n++;continue}}catch(g){console.log("[RESOLVE] Decode failed:",g.message)}}if(i.match(/<button[^>]*id=["']?(downloadbtn|download-btn|btn-download)[^"']*["']?[^>]*>/i)){console.log("[RESOLVE] Found download button, extracting URL from JS...");let g=[/https?:\/\/video-downloads\.googleusercontent\.com\/[^\s"'<>)]+/,/https?:\/\/[^\s"'<>]+pixeldrain\.com[^\s"'<>]+/,/https?:\/\/drive\.google\.com[^\s"'<>]+/,/var\s+(?:download_?url|file_?url|link)\s*=\s*["']([^"']+)["']/i,/location\.href\s*=\s*["']([^"']+)["']/i,/window\.open\(["']([^"']+)["']/i];for(let p of g){let a=i.match(p);if(a){let R=a[1]||a[0];if(R&&R.startsWith("http")){console.log("[RESOLVE] Extracted URL from button JS"),o=R,n++;continue}}}}let x=[/https?:\/\/video-downloads\.googleusercontent\.com\/[^\s"'<>)]+/,/https?:\/\/pixeldrain\.com\/api\/file\/[^\s"'<>]+/,/https?:\/\/drive\.google\.com\/uc\?[^\s"'<>]+/];for(let g of x){let p=i.match(g);if(p)return console.log("[RESOLVE] Found direct URL in HTML"),p[0]}let E=/<a[^>]*href=["']([^"']*)["'][^>]*>([^<]*)</gi,w;for(;(w=E.exec(i))!==null;){let g=w[1],p=w[2];if(!(!g||!g.startsWith("http"))&&!p.match(/telegram|zipdisk|ads/i)&&!(g.includes("dl.php?link=")&&g===o)&&p.match(/download|get file|click here|direct link|server/i)){if(console.log("[RESOLVE] Found download link:",p),ue(g))return g;o=g,n++;break}}let y=i.match(/<meta[^>]*http-equiv=["']refresh["'][^>]*content=["'][^"']*url=([^"'\s]+)/i);if(y&&y[1]){console.log("[RESOLVE] Following meta refresh"),o=y[1],n++;continue}let C=i.match(/(?:window\.location|location\.href)\s*=\s*["']([^"']+)["']/);if(C){let g=C[1];if(s.some(a=>g.includes(a)))console.log("[RESOLVE] Skipping ad redirect");else{console.log("[RESOLVE] Following JS redirect"),o=g,n++;continue}}return console.log("[RESOLVE] No more redirects found on this page"),D(o)?(console.log("[RESOLVE] WARNING: Stopped on redirect link, not direct download"),console.log("[RESOLVE] Returning original URL instead"),e):o}return o}catch(r){return console.log("[RESOLVE] Error:",r.message),D(o)?(console.log("[RESOLVE] Error occurred on redirect link, returning original"),e):o}}return console.log("[RESOLVE] Max hops reached"),D(o)?(console.log("[RESOLVE] WARNING: Max hops reached but still on redirect link!"),console.log("[RESOLVE] Returning original URL instead"),e):o})}function de(e){return m(this,null,function*(){console.log("[REDIRECT] Processing:",e);try{let t=yield H(e),o=/s\('o','([A-Za-z0-9+/=]+)'|ck\('_wp_http_\d+','([^']+)'/g,n="",s;for(;(s=o.exec(t))!==null;){let f=s[1]||s[2];f&&(n+=f)}if(!n)return console.log("[REDIRECT] No encoded data found"),e;let r=b(B(b(b(n)))),c=JSON.parse(r),l=b(c.o||"").trim();if(l)return console.log("[REDIRECT] Decoded URL:",l),D(l)?yield P(l):l;let i=se(c.data||"").trim(),d=(c.blog_url||"").trim();if(d&&i){console.log("[REDIRECT] Fetching from wpHttp");let f=yield H(`${d}?re=${i}`),h=z(f);return console.log("[REDIRECT] Final URL:",h),D(h)?yield P(h):h}return e}catch(t){return console.log("[REDIRECT] Error:",t.message),e}})}function q(e){return m(this,null,function*(){console.log("[PIXELDRAIN] Extracting from:",e);let t=e.match(/(?:file|u)\/([A-Za-z0-9]+)/),o=t?t[1]:e.split("/").pop();if(!o)return console.log("[PIXELDRAIN] No file ID found"),[];try{console.log("[PIXELDRAIN] File ID:",o);let n=yield le(`https://pixeldrain.com/api/file/${o}/info`);if(!n)return console.log("[PIXELDRAIN] Failed to fetch file info"),[];let s=n.name?n.name.match(/(\d{3,4})p/):null;return[{source:"Pixeldrain",quality:s?s[0]:"Unknown",url:`https://pixeldrain.com/api/file/${o}?download`,size:n.size||0,filename:n.name}]}catch(n){return console.log("[PIXELDRAIN] Error:",n.message),[]}})}function he(e,t){return m(this,null,function*(){console.log("[HUBDRIVE] Extracting from:",e);try{let n=(yield H(e,{Referer:t})).match(new RegExp(`<a[^>]*href=["']([^"']*hubcloud[^"']*)["'][^>]*>.*?\\[HubCloud Server\\]`,"is"));if(n&&n[1]){let s=n[1];return console.log("[HUBDRIVE] Found HubCloud link:",s),yield W(s,e)}return console.log("[HUBDRIVE] No HubCloud link found"),[]}catch(o){return console.log("[HUBDRIVE] Error:",o.message),[]}})}function W(e,t){return m(this,null,function*(){console.log("[HUBCLOUD] Extracting from:",e);let o=e;o.includes("hubcloud.ink")&&(o=o.replace("hubcloud.ink","hubcloud.dad"));try{let n=yield H(o,{Referer:t});if(!o.includes("hubcloud.php")){let x=n.match(/var url = '([^']*)'/);x&&x[1]&&(o=x[1],console.log("[HUBCLOUD] Following script URL:",o),n=yield H(o,{Referer:e}))}let s=n.match(/<i[^>]*id=["']size["'][^>]*>([^<]*)<\/i>/i),r=s?s[1].trim():"",c=N(r),l=n.match(/<div[^>]*class=["'][^"']*card-header[^"']*["'][^>]*>([^<]*)<\/div>/i),d=(l?l[1].trim():"").match(/(\d{3,4})p/),f=d?d[0]:"Unknown";console.log("[HUBCLOUD] Size:",r,"Quality:",f);let h=_(n),u=[];for(let x of h){let E=x.text,w=x.href;if(E.includes("ZipDisk")||E.includes("Telegram")){console.log("[HUBCLOUD] Skipping:",E);continue}let y=`HubCloud [${E}]`;if(D(w)&&(console.log("[HUBCLOUD] Resolving redirect link:",w.substring(0,60)+"..."),w=yield P(w),console.log("[HUBCLOUD] Resolved to:",w.substring(0,60)+"...")),E.includes("Download File")||E.includes("FSL")||E.includes("S3")||E.includes("10Gbps"))console.log("[HUBCLOUD] Direct server:",E),u.push({source:y,quality:f,url:w,size:c});else if(E.includes("BuzzServer")){console.log("[HUBCLOUD] Processing BuzzServer");let C=yield ae(`${w}/download`,{Referer:w});C&&(console.log("[HUBCLOUD] BuzzServer URL:",C),u.push({source:y,quality:f,url:C,size:c}))}else if(w.includes("pixeldra")){console.log("[HUBCLOUD] Found Pixeldrain link");let C=yield q(w);C[0]&&u.push(C[0])}else E.match(/download|server|link/i)&&(console.log("[HUBCLOUD] Other download link:",E),u.push({source:y,quality:f,url:w,size:c}))}return console.log(`[HUBCLOUD] Extracted ${u.length} direct download links`),u}catch(n){return console.log("[HUBCLOUD] Error:",n.message),[]}})}function ge(e,t){return m(this,null,function*(){console.log("[HUBCDN] Extracting from:",e);try{let o=yield H(e,{Referer:t}),n=o.match(/<i[^>]*id=["']size["'][^>]*>([^<]*)<\/i>/i),s=n?n[1].trim():"",r=N(s),c=o.match(/(\d{3,4})p/),l=c?c[0]:"Unknown";console.log("[HUBCDN] Size:",s,"Quality:",l);let i=_(o),d=[];for(let f of i){let h=f.text,u=f.href;h.includes("Telegram")||h.includes("ZipDisk")||(h.includes("Download")||h.includes("Server"))&&(console.log("[HUBCDN] Found download link:",h),D(u)&&(console.log("[HUBCDN] Resolving redirect..."),u=yield P(u),console.log("[HUBCDN] Resolved to:",u.substring(0,60)+"...")),d.push({source:"HubCdn",quality:l,url:u,size:r}))}return console.log(`[HUBCDN] Extracted ${d.length} direct download links`),d}catch(o){return console.log("[HUBCDN] Error:",o.message),[]}})}function fe(e,t){return m(this,null,function*(){console.log("[HUBSTREAM] Extracting from:",e);try{let o=yield H(e,{Referer:t}),n=o.match(/(\d{3,4})p/),s=n?n[0]:"Unknown",r=new RegExp(`<a[^>]*href=["']([^"']*)["'][^>]*>.*?(?:Download|Server|Direct)`,"gis"),c=[],l;for(;(l=r.exec(o))!==null;){let i=l[1];i&&i.startsWith("http")&&(console.log("[HUBSTREAM] Found download link"),D(i)&&(console.log("[HUBSTREAM] Resolving redirect..."),i=yield P(i),console.log("[HUBSTREAM] Resolved to:",i.substring(0,60)+"...")),c.push({source:"Hubstream",quality:s,url:i,size:0}))}return console.log(`[HUBSTREAM] Extracted ${c.length} direct download links`),c}catch(o){return console.log("[HUBSTREAM] Error:",o.message),[]}})}var M="https://cache.leokimpese.workers.dev";function pe(e,t,o,n){return`${e}_${t}_${o||"null"}_${n||"null"}`}function me(e,t,o,n){return m(this,null,function*(){let s=pe(e,t,o,n);try{console.log("[API-CACHE] Fetching:",s);let r=yield fetch(`${M}/${s}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(r.status===404)return console.log("[API-CACHE] Miss:",s),null;if(!r.ok)return console.log("[API-CACHE] Error:",r.status),null;let c=yield r.json();return!c||!c.streams||!Array.isArray(c.streams)?(console.log("[API-CACHE] Invalid response format"),null):(console.log(`[API-CACHE] Hit: ${s} (${c.streams.length} streams)`),c.streams)}catch(r){return console.log("[API-CACHE] Fetch error:",r.message),null}})}function Ee(e,t,o,n,s,r=3600){return m(this,null,function*(){let c=pe(e,t,o,n);try{console.log(`[API-CACHE] Saving: ${c} (${s.length} streams, TTL: ${r}s)`);let l=yield fetch(M,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:c,streams:s,ttl:r,metadata:{tmdbId:e,mediaType:t,season:o,episode:n,timestamp:Date.now()}})});return l.ok?(console.log("[API-CACHE] Saved successfully"),!0):(console.log("[API-CACHE] Save failed:",l.status),!1)}catch(l){return console.log("[API-CACHE] Save error:",l.message),!1}})}function xe(){return m(this,null,function*(){try{console.log("[API-CACHE] Clearing all cache...");let e=yield fetch(`${M}/clearall`,{method:"POST"});return e.ok?(console.log("[API-CACHE] All cache cleared"),!0):(console.log("[API-CACHE] Clear failed:",e.status),!1)}catch(e){return console.log("[API-CACHE] Clear error:",e.message),!1}})}function G(){return m(this,null,function*(){try{let e=yield fetch(`${M}/stats`,{method:"GET"});return e.ok?yield e.json():{totalEntries:0,totalSize:0,error:"Failed to fetch stats"}}catch(e){return console.log("[API-CACHE] Stats error:",e.message),{totalEntries:0,totalSize:0,error:e.message}}})}var we=!1;function Ie(e){return m(this,null,function*(){let t=e.replace(/Season \d+/i,"").trim(),o=new URLSearchParams({q:t,query_by:"post_title",sort_by:"sort_by_date:desc"});try{let s=yield(yield I(`${te}?${o.toString()}`)).json(),r=[];if(s.hits&&s.hits.length>0)return s.hits.forEach(u=>{r.push({title:u.document.post_title,url:U+u.document.permalink,source:"Pingora",searchedTitle:e})}),r;console.log(`[Search] "${e}" - Pingora returned 0 results, trying Native Search`);let c=`${U}/?s=${encodeURIComponent(t)}`,i=yield(yield I(c)).text(),d=[],f=new RegExp("<article[^>]*>.*?<\\/article>","gis");return(i.match(f)||[]).forEach(u=>{let x=u.match(/<a[^>]*href=["']([^"']*)["'][^>]*>(.*?)<\/a>/i);if(x){let E=x[1],w=x[2].replace(/<[^>]*>/g,"").trim();E&&w&&d.push({title:w,url:E,source:"Native",searchedTitle:e})}}),d}catch(n){return console.log(`[Search] "${e}" - Error:`,n.message),[]}})}function Pe(e){return m(this,null,function*(){console.log(`[Parallel Search] Searching ${e.length} titles simultaneously...`);let t=Date.now(),o=e.map(r=>Ie(r)),n=yield Promise.all(o),s=Date.now()-t;console.log(`[Parallel Search] Completed in ${s}ms`);for(let r=0;r<n.length;r++)if(n[r].length>0)return console.log(`[Parallel Search] Found ${n[r].length} results for: "${e[r]}"`),{results:n[r],usedTitle:e[r]};return console.log("[Parallel Search] No results found in any search"),{results:[],usedTitle:""}})}function j(o){return m(this,arguments,function*(e,t=U){if(!e)return console.log("[EXTRACTOR] Empty URL"),[];console.log("[EXTRACTOR] Processing:",e);try{let n=new URL(e).hostname.toLowerCase();if(e.includes("?id=")||n.includes("techyboy")||n.includes("gdtot")){let s=yield de(e);return s&&s!==e?yield j(s,e):[]}if(n.includes("hubcloud"))return yield W(e,t);if(n.includes("hubcdn"))return yield ge(e,t);if(n.includes("hubdrive"))return yield he(e,t);if(n.includes("pixeldrain"))return yield q(e);if(n.includes("hubstream"))return yield fe(e,t);if(n.includes("hblinks")){let r=yield(yield I(e,{Referer:t})).text(),c=/<a[^>]*href=["']([^"']*)["'][^>]*>/gi,l=[],i;for(;(i=c.exec(r))!==null;){let h=i[1];if(h&&h.startsWith("http")){if(h.includes("hblinks.dad")&&!h.includes("/archives/"))continue;l.push(h)}}console.log(`[HBLINKS] Found ${l.length} valid links - processing in parallel`);let d=l.map(h=>j(h,e));return(yield Promise.all(d)).flat()}return console.log("[EXTRACTOR] No matching extractor"),[]}catch(n){return console.log("[EXTRACTOR] Error:",n.message),[]}})}function $e(e,t){return m(this,null,function*(){console.log(`[Parallel Extraction] Processing ${e.length} links simultaneously...`);let o=Date.now(),n=e.map(l=>j(l,t).catch(i=>(console.log(`[Parallel Extraction] Error on ${l}:`,i.message),[]))),s=yield Promise.all(n),r=Date.now()-o,c=s.flat().length;return console.log(`[Parallel Extraction] Completed in ${r}ms - Found ${c} streams`),s.flat()})}function Oe(e,t,o,n){let s=[],r=i=>i.includes("hdhub4u.")||/\/20\d{2}\//.test(i)||i.includes("-hindi-")||i.includes("-movie/")||i.includes("-series/")||i.includes("-episodes/")||i.includes("facebook.com")||i.includes("telegram.me")||i.includes("how-to-download")||i.toLowerCase().endsWith(".zip")||i.toLowerCase().includes(".zip?");if(t==="movie"){let i=new RegExp(`<a[^>]*href=["']([^"']*)["'][^>]*>(.*?)<\\/a>`,"gis"),d;for(;(d=i.exec(e))!==null;){let f=d[1],h=d[2].replace(/<[^>]*>/g,"");if(r(f))continue;let u=e.substring(Math.max(0,d.index-200),Math.min(e.length,d.index+400));(h+u).match(/1080p|2160p|4k/i)&&f&&f.startsWith("http")&&s.push({url:f,requiresQualityCheck:!1,preFilteredQuality:!0})}}else if(t==="tv"&&o&&n){let i=parseInt(n),d=i+1,f=new RegExp(`<(?:h[1-6]|strong|span|a)[^>]*>\\s*(?:Episode|Ep|E|EPiSODE)\\s*0?${i}\\b`,"i"),h=new RegExp(`<(?:h[1-6]|strong|span|a)[^>]*>\\s*(?:Episode|Ep|E|EPiSODE)\\s*0?${d}\\b`,"i"),u=e.match(f);if(u){let x=u.index,E=e.substring(x+10).match(h),w=E?x+10+E.index:x+6e3,y=e.substring(x,w);if(console.log(`[TV] Analyzing slice for Episode ${i} (${y.length} chars)`),/1080p|2160p|4k|uhd|720p|480p/i.test(y)){console.log("[TV] Quality labels found in episode block. Filtering at HTML stage.");let C=/(720p|480p|360p|1080p|2160p|4k|uhd)/gi,g=[],p;for(C.lastIndex=0;(p=C.exec(y))!==null;)g.push({quality:p[1].toLowerCase(),index:p.index,isHighQuality:/1080p|2160p|4k|uhd/i.test(p[1])});console.log(`[TV] Found ${g.length} quality markers`);for(let a=0;a<g.length;a++){let R=g[a];if(!R.isHighQuality){console.log(`[TV] Marker ${a+1}: ${R.quality} - SKIPPING (low quality)`);continue}console.log(`[TV] Marker ${a+1}: ${R.quality} - PROCESSING (high quality)`);let A=R.index,k=g[a+1],T=k?k.index:y.length,Q=y.substring(A,T);console.log(`[TV]   Search zone: ${Q.length} chars`);let Re=/<a[^>]*href=["']([^"']+)["'][^>]*>/gi,J,K=0;for(;(J=Re.exec(Q))!==null;){let $=J[1];$.startsWith("http")&&!r($)&&(console.log(`[TV]   \u2192 Found link: ${$.substring(0,60)}...`),K++,s.push({url:$,requiresQualityCheck:!1,preFilteredQuality:!0}))}K===0&&console.log("[TV]   \u2192 No links found in this zone")}}else{console.log("[TV] No quality labels in episode block. Will check quality during extraction.");let C=/href=["']([^"']+)["']/gi,g;for(;(g=C.exec(y))!==null;){let p=g[1];p.startsWith("http")&&!r(p)&&s.push({url:p,requiresQualityCheck:!0,preFilteredQuality:!1})}}}}let c=new Set,l=[];for(let i of s)c.has(i.url)||(c.add(i.url),l.push(i));return l}function ve(e,t,o,n){return Oe(e,t,o,n).map(r=>r.url)}function Me(e,t,o,n){return m(this,null,function*(){if(console.log("[HDHub4u] Starting:",e,t,o,n),we)console.log("[CACHE] \u26A0\uFE0F  DISABLED FOR TESTING - Fresh fetch every time");else try{let s=yield me(e,t,o,n);if(s)return console.log(`[HDHub4u] \u26A1 Returning ${s.length} cached streams from API`),V(),s}catch(s){console.log("[HDHub4u] Cache fetch error, continuing with fresh fetch:",s.message)}try{let C=function(a){if(!a)return 0;let R=a.match(/([\d.]+)\s*(GB|MB|KB|B)/i);if(!R)return 0;let A=parseFloat(R[1]),k=R[2].toUpperCase(),T={B:1,KB:1024,MB:1024*1024,GB:1024*1024*1024};return A*(T[k]||0)};V();let s=`https://api.themoviedb.org/3/${t}/${e}?api_key=342c3872f1357c6e1da3a5ac1ccc3605&append_to_response=external_ids`,r=yield fetch(s).then(a=>a.json()),c=r.imdb_id||r.external_ids&&r.external_ids.imdb_id,l=t==="tv"?r.name:r.title,i="";t==="movie"&&r.release_date?i=r.release_date.split("-")[0]:t==="tv"&&r.first_air_date&&(i=r.first_air_date.split("-")[0]);let d=[];if(c){console.log("[HDHub4u] IMDb ID found:",c);let[a,R]=yield Promise.all([fetch(`https://api.imdbapi.dev/titles/${c}`).then(A=>A.json()).catch(()=>null),fetch(`https://api.imdbapi.dev/titles/${c}/akas`).then(A=>A.json()).catch(()=>({akas:[]}))]);a&&(a.originalTitle&&d.push(a.originalTitle),a.primaryTitle&&!d.includes(a.primaryTitle)&&d.push(a.primaryTitle),l=a.originalTitle||a.primaryTitle),R&&R.akas&&R.akas.filter(k=>k.country&&k.country.code==="IN").map(k=>k.text).filter(k=>/^[a-zA-Z0-9\s\-':.!&]+$/.test(k)).forEach(k=>{d.includes(k)||d.push(k)})}d.length===0&&d.push(l);let{results:f,usedTitle:h}=yield Pe(d);if(f.length===0)return console.log("[HDHub4u] No search results - NOT caching empty result"),[];let u=f.find(a=>ie(h,a.title)?!(t==="tv"&&o&&!a.title.toLowerCase().includes(`season ${o}`)):!1);if(!u)return console.log("[HDHub4u] No valid match found - NOT caching empty result"),[];console.log("[HDHub4u] Found Page:",u.title);let x=yield H(u.url),E=ve(x,t,o,n);console.log(`[HDHub4u] Found ${E.length} candidate links`);let w=yield $e(E,u.url),y=[];w.forEach(a=>{!a||!a.url||a.quality==="Unknown"||a.quality.includes("480p")||a.quality.includes("720p")||y.push({name:a.quality,title:`${l}${i?` (${i})`:""} ${t==="tv"?`S${o}E${n}`:""}`,url:a.url,size:re(a.size),headers:S})});let p=y.sort((a,R)=>{let A={"2160p":10,"4k":10,"1080p":8},k=A[a.name.toLowerCase()]||0,T=A[R.name.toLowerCase()]||0;return T!==k?T-k:C(R.size)-C(a.size)}).map((a,R)=>ee(L({},a),{name:`${R+1}. ${a.name}`}));return p.length===0?(console.log("[HDHub4u] No valid streams extracted - NOT caching empty result"),[]):(we?console.log("[CACHE] \u26A0\uFE0F  Not saving to cache (testing mode)"):Ee(e,t,o,n,p,3600).then(()=>(console.log(`[API-CACHE] \u2705 Cached ${p.length} streams in background`),G())).then(a=>{console.log(`[API-CACHE] Stats: ${a.totalEntries||0} entries, ${a.totalSize||0} total streams`)}).catch(a=>{console.log("[API-CACHE] Background save error (non-critical):",a.message)}),console.log(`[HDHub4u] \u2705 Returning ${p.length} streams to user`),p)}catch(s){return console.error("[HDHub4u] Critical Error:",s),[]}})}
